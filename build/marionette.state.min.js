function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}();!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e(require("underscore"),require("backbone.marionette"),require("backbone")):"function"==typeof define&&define.amd?define(["underscore","backbone.marionette","backbone"],e):t.Marionette.State=e(t._,t.Mn,t.Backbone)}(this,function(t,e,n){"use strict";function i(e,i,s,o){var r,a={syncing:!0},u=i instanceof n.Collection&&s.match(c),f=(i instanceof n.Model||i instanceof h)&&(r=s.match(l));if(u||f){var v,b=[i];if(r&&(v=r[1])&&b.push(i.get(v)),b.push(a),t.isFunction(o))o.apply(e,b);else for(var p=o.split(d),g=0;g<p.length;g++){var y=p[g];e[y].apply(e,b)}}}function s(t,e,n){if(!e)throw new Error("`entity` must be provided.");if(!n)throw new Error("`bindings` must be provided.");for(var s in n)for(var o=n[s],r=s.split(d),a=0;a<r.length;a++){var h=r[a];i(t,e,h,o)}}function o(t,e,n,i){var s=new f(t,e,n);return i?s._when(i):s._now(),s}function r(e){e._model&&(e=e._model);for(var n=arguments.length,i=Array(n>1?n-1:0),s=1;s<n;s++)i[s-1]=arguments[s];return!!t.chain(e.changed).keys().intersection(i).size().value()}var a=e.Object.extend({modelClass:void 0,defaultState:void 0,componentEvents:void 0,_model:void 0,_component:void 0,_initialState:void 0,_:void 0,constructor:function(){var t=this,e=arguments.length<=0||void 0===arguments[0]?{}:arguments[0],i=e.initialState,s=e.component,o=e.preventDestroy,r=e.pure,h=void 0===r?"s":r,u=e.proxy;Object.defineProperty(this,"attributes",{get:function(){return this._model.attributes},set:function(t){this._model.attributes=t}}),this.modelClass=this.modelClass||n.Model,this._initState(i),s&&this.bindComponent(s,{preventDestroy:o}),void 0!==u&&(u=this._model.toJSON()),this[h]=this._model.toJSON(),this._model.on("change",function(e){void 0!==u&&(u=e),t[h]=e}),a.__super__.constructor.apply(this,arguments)},_initState:function(e){this._initialState=t.extend({},this.defaultState,e),this._model=new this.modelClass(this._initialState),this._proxyModelEvents(this._model)},getModel:function(){return this._model},getInitialState:function(){return t.clone(this._initialState)},get:function(t){return this._model.get(t)},set:function(t,e,n){return this._model.set(t,e,n),this},reset:function(e,n){var i=t.extend({},this._initialState,e);return this._model.set(i,n),this},changedAttributes:function(){return this._model.changedAttributes()},previous:function(t){return this._model.previous(t)},previousAttributes:function(){return this._model.previousAttributes()},hasAnyChanged:function(){for(var t=arguments.length,e=Array(t),n=0;n<t;n++)e[n]=arguments[n];return a.hasAnyChanged.apply(a,[this].concat(e))},toJSON:function(){return this._model.toJSON()},bindComponent:function(t){var e=arguments.length<=1||void 0===arguments[1]?{}:arguments[1],n=e.preventDestroy;this.bindEvents(t,this.componentEvents),n||this.listenTo(t,"destroy",this.destroy)},unbindComponent:function(t){this.unbindEvents(t,this.componentEvents),this.stopListening(t,"destroy",this.destroy)},syncEntityEvents:function(t,e,n){return a.syncEntityEvents(this,t,e,n),this},_proxyModelEvents:function(t){this.listenTo(t,"all",function(){arguments.length>1&&arguments[1]===this._model&&(arguments[1]=this),this.trigger.apply(this,arguments)})}}),h=a,u=Object.defineProperties({},{sync:{get:function(){return s},configurable:!0,enumerable:!0},syncEntityEvents:{get:function(){return o},configurable:!0,enumerable:!0},hasAnyChanged:{get:function(){return r},configurable:!0,enumerable:!0}}),l=/^(?:all|change|change:(.+))$/,c=/^(?:all|reset)$/,d=/\s+/,f=function(){function n(t,e,i){_classCallCheck(this,n),this.target=t,this.entity=e,this.bindings=i}return _createClass(n,[{key:"stop",value:function(){e.unbindEvents(this.target,this.entity,this.bindings),this.target.off(this.event,this.handler),this.event=this.handler=null}},{key:"_when",value:function(n){e.bindEvents(this.target,this.entity,this.bindings),this.event=n,this.handler=t.bind(s,this,this.target,this.entity,this.bindings),this.target.on(this.event,this.handler).on("destroy",t.bind(this.stop,this))}},{key:"_now",value:function(){e.bindEvents(this.target,this.entity,this.bindings),s(this.target,this.entity,this.bindings)}}]),n}();t.extend(h,u);var v=h;return v});
//# sourceMappingURL=marionette.state.min.js.map
